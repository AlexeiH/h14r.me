package me.h14r.invoicemaker.template;

import java.math.BigDecimal;
import java.util.Stack;

public class RussianMoney {

  private static enum Ranges {
    UNITS, DECADES, HUNDREDS, THOUSANDS, MILLIONS, BILLIONS
  }

  ;

  private static Stack<ThreeChar> threeChars;

  private static class ThreeChar {

    char h, d, u;
    Ranges range;
  }

  public static String digits2text(BigDecimal d) {
    String s = d.toPlainString();
    String[] sa = s.split("\\.");
    threeChars = new Stack<ThreeChar>();
    threeChars.push(new ThreeChar());
    threeChars.peek().range = Ranges.UNITS;
    StringBuilder sb = new StringBuilder(sa[0]).reverse();
    for (int i = 0; i < sb.length(); i++) {
      if (i > 0 && i % 3 == 0) {
        threeChars.push(new ThreeChar());
      }
      ThreeChar threeChar = threeChars.peek();
      switch (i) {
        case 0:
          threeChar.u = sb.charAt(i);
          break;
        case 3:
          threeChar.range = Ranges.THOUSANDS;
          threeChar.u = sb.charAt(i);
          break;
        case 6:
          threeChar.range = Ranges.MILLIONS;
          threeChar.u = sb.charAt(i);
          break;
        case 9:
          threeChar.range = Ranges.BILLIONS;
          threeChar.u = sb.charAt(i);
          break;
        case 2:
        case 5:
        case 8:
          threeChar.h = sb.charAt(i);
          break;
        default:
          threeChar.d = sb.charAt(i);
      }
    }
    StringBuilder result = new StringBuilder();
    while (!threeChars.isEmpty()) {
      ThreeChar thch = threeChars.pop();
      if (thch.h == '0' && thch.d == '0' && thch.u == '0' && !threeChars.isEmpty())
        continue;
      if (thch.h > 0) {
        result.append(getHundreds(thch.h));
        result.append(' ');
      }
      if (thch.d > '0') {
        if (thch.d > '1' || (thch.d == '1' && thch.u == '0')) {
          result.append(getDecades(thch.d));
        } else if (thch.d > '0') {
          result.append(getTeens(thch.d));
        }
        result.append(' ');
      }
      if (thch.u > '0' && thch.d != '1') {
        result.append(getUnits(thch.u, thch.range == Ranges.THOUSANDS));
        result.append(' ');
      }
      switch (thch.range) {
        case BILLIONS:
          if (thch.d == '1' || thch.u == '0') {
            result.append("миллиардов");
          } else if (thch.u > '4') {
            result.append("миллиардов");
          } else if (thch.u > '1') {
            result.append("миллиарда");
          } else {
            result.append("миллиард");
          }
          break;
        case MILLIONS:
          if (thch.d == '1' || thch.u == '0') {
            result.append("миллионов");
          } else if (thch.u > '4') {
            result.append("миллионов");
          } else if (thch.u > '1') {
            result.append("миллиона");
          } else {
            result.append("миллион");
          }
          break;
        case THOUSANDS:
          if (thch.d == '1' || thch.u == '0') {
            result.append("тыс€ч");
          } else if (thch.u > '4') {
            result.append("тыс€ч");
          } else if (thch.u > '1') {
            result.append("тыс€чи");
          } else {
            result.append("тыс€ча");
          }
          break;
      }
      result.append(' ');
    }
    char first = Character.toUpperCase(result.charAt(0));
    result.setCharAt(0, first);
    return result.toString().replaceAll("null", "");
  }

  private static String getHundreds(char dig) {
    switch (dig) {
      case '1':
        return "сто";
      case '2':
        return "двести";
      case '3':
        return "триста";
      case '4':
        return "четыреста";
      case '5':
        return "п€тьсот";
      case '6':
        return "шестсот";
      case '7':
        return "семсот";
      case '8':
        return "восемсот";
      case '9':
        return "дев€тьсот";
      default:
        return null;
    }
  }

  private static String getDecades(char dig) {
    switch (dig) {
      case '1':
        return "дес€ть";
      case '2':
        return "двадцать";
      case '3':
        return "тридцать";
      case '4':
        return "сорок";
      case '5':
        return "п€тьдес€т";
      case '6':
        return "шестьдес€т";
      case '7':
        return "семьдес€т";
      case '8':
        return "восемьдес€т";
      case '9':
        return "дев€носто";
      default:
        return null;
    }
  }

  private static String getUnits(char dig, boolean female) {
    switch (dig) {
      case '1':
        return female ? "одна" : "один";
      case '2':
        return female ? "две" : "два";
      case '3':
        return "три";
      case '4':
        return "четыре";
      case '5':
        return "п€ть";
      case '6':
        return "шесть";
      case '7':
        return "семь";
      case '8':
        return "восемь";
      case '9':
        return "дев€ть";
      default:
        return null;
    }
  }

  private static String getTeens(char dig) {
    String s = "";
    switch (dig) {
      case '1':
        s = "один";
        break;
      case '2':
        s = "две";
        break;
      case '3':
        s = "три";
        break;
      case '4':
        s = "четыр";
        break;
      case '5':
        s = "п€т";
        break;
      case '6':
        s = "шест";
        break;
      case '7':
        s = "сем";
        break;
      case '8':
        s = "восем";
        break;
      case '9':
        s = "дев€т";
        break;
    }
    return s + "надцать";
  }

}
